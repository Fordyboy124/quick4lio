{% extends "base.html" %}
{% block title %}Edit Portfolio{% endblock %}
{% block content %}
<h1 class="text-3xl font-bold text-primary mb-6">Create or Edit Your Portfolio</h1>
<div class="bg-white p-8 rounded-xl shadow-lg border border-gray-200">
    <form method="POST" action="{{ url_for('edit_portfolio') }}">
        <div class="mb-6">
            <label class="block text-gray-700 text-sm font-bold mb-2">Select a Plan:</label>
            <div class="flex items-center space-x-4">
                <label class="inline-flex items-center">
                    <input type="radio" name="portfolio_type" value="Free" class="form-radio text-primary" {% if portfolio and portfolio.portfolio_type == 'Free' %}checked{% endif %}>
                    <span class="ml-2">Free</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="radio" name="portfolio_type" value="Paid" class="form-radio text-primary" {% if portfolio and portfolio.portfolio_type == 'Paid' %}checked{% endif %}>
                    <span class="ml-2">Paid</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="radio" name="portfolio_type" value="Premium" class="form-radio text-primary" {% if portfolio and portfolio.portfolio_type == 'Premium' %}checked{% endif %}>
                    <span class="ml-2">Premium</span>
                </label>
            </div>
        </div>

        <div class="space-y-6">
            <div id="free-plan-sections" class="plan-section">
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-primary mb-2">Header</h2>
                    <input type="text" name="name" placeholder="Your Name" value="{{ (sections_data.header | default({})).name | default('') }}" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary mb-2">
                    <input type="text" name="title" placeholder="Your Title (e.g., Software Engineer)" value="{{ (sections_data.header | default({})).title | default('') }}" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-primary mb-2">About Me</h2>
                    <textarea name="bio" rows="4" placeholder="Write a short biography about yourself..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary">{{ (sections_data.about | default({})).bio | default('') }}</textarea>
                </div>
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-primary mb-2">Projects</h2>
                    <div class="space-y-4">
                        {% set projects = sections_data.projects | default([]) %}
                        <div>
                            <input type="text" name="project_name_1" placeholder="Project Title" value="{{ (projects[0] | default({})).name | default('') if projects|length > 0 else '' }}" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary mb-2">
                            <textarea name="project_desc_1" rows="2" placeholder="Project description..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary mb-2">{{ (projects[0] | default({})).desc | default('') if projects|length > 0 else '' }}</textarea>
                            <input type="text" name="project_img_1" placeholder="Project Image URL (Cloudinary)" value="{{ (projects[0] | default({})).image | default('') if projects|length > 0 else '' }}" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                    </div>
                </div>
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-primary mb-2">Skills</h2>
                    <input type="text" name="skills" placeholder="Skill1, Skill2, Skill3 (comma-separated)" value="{{ ', '.join(sections_data.skills | default([])) }}" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-primary mb-2">Contact Info</h2>
                    <input type="email" name="contact_email" placeholder="Your Email" value="{{ (sections_data.contact | default({})).email | default('') }}" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary mb-2">
                    <input type="tel" name="contact_phone" placeholder="Your Phone Number" value="{{ (sections_data.contact | default({})).phone | default('') }}" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
            </div>

            <div id="paid-plan-sections" class="plan-section hidden">
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-primary mb-2">Paid Plan Additions</h2>
                    <p class="text-gray-600 mb-4">Content for your Home page introduction.</p>
                    <textarea name="home_content" rows="4" placeholder="Content for your home page..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary">{{ (sections_data.paid_pages | default({})).home_content | default('') }}</textarea>
                </div>
            </div>

            <div id="premium-plan-sections" class="plan-section hidden">
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-primary mb-2">Premium Plan Additions</h2>
                    <p class="text-gray-600 mb-4">Features like Case Studies, Testimonials, and Blog.</p>
                    <textarea name="case_studies" rows="3" placeholder="Case studies content..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary mb-2">{{ (sections_data.premium_pages | default({})).case_studies | default('') }}</textarea>
                    <textarea name="testimonials" rows="3" placeholder="Testimonials from clients..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary mb-2">{{ (sections_data.premium_pages | default({})).testimonials | default('') }}</textarea>
                    <input type="url" name="resume_link" placeholder="Link to your Resume/CV" value="{{ (sections_data.premium_pages | default({})).resume_link | default('') }}" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary mb-2">
                    <input type="text" name="awards" placeholder="Awards & Certifications" value="{{ (sections_data.premium_pages | default({})).awards | default('') }}" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
            </div>
        </div>

        <button type="submit" class="w-full px-4 py-2 bg-primary text-white font-semibold rounded-full hover:bg-blue-800 transition duration-300">Save Portfolio</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const planRadios = document.querySelectorAll('input[name="portfolio_type"]');
        const sections = {
            'Free': document.getElementById('free-plan-sections'),
            'Paid': document.getElementById('paid-plan-sections'),
            'Premium': document.getElementById('premium-plan-sections')
        };

        function showSections(planType) {
            // Hide all sections initially
            Object.values(sections).forEach(section => section.classList.add('hidden'));

            // Show sections based on plan hierarchy
            if (planType === 'Free') {
                sections['Free'].classList.remove('hidden');
            } else if (planType === 'Paid') {
                sections['Free'].classList.remove('hidden');
                sections['Paid'].classList.remove('hidden');
            } else if (planType === 'Premium') {
                sections['Free'].classList.remove('hidden');
                sections['Paid'].classList.remove('hidden');
                sections['Premium'].classList.remove('hidden');
            }
        }

        planRadios.forEach(radio => {
            radio.addEventListener('change', (event) => {
                showSections(event.target.value);
            });
        });

        // Show the correct sections on initial page load
        const initialPlan = document.querySelector('input[name="portfolio_type"]:checked').value;
        showSections(initialPlan);
    });
</script>
{% endblock %}